#include <DHT.h>
#include <TinyGPS++.h>
#include <SoftwareSerial.h>
#include <Wire.h>
#include <LiquidCrystal_I2C.h>

#define DHTPIN 2           // Pin where the DHT sensor is connected
#define DHTTYPE DHT11      // Define DHT sensor type (DHT11 or DHT22)
DHT dht(DHTPIN, DHTTYPE);  // Initialize DHT sensor

const int pulsePin = A0;   // Heart rate sensor connected to analog pin A0
int pulseValue = 0;        // Variable to store pulse sensor data

SoftwareSerial ss(4, 3);   // GPS module RX, TX pins
TinyGPSPlus gps;           // Instantiate TinyGPSPlus object for GPS data

SoftwareSerial gsmSerial(7, 8);  // GSM module RX, TX pins
LiquidCrystal_I2C lcd(0x27, 16, 2);  // LCD display (I2C address 0x27)

void setup() {
  Serial.begin(9600);      // Start the serial communication
  dht.begin();             // Initialize DHT sensor
  ss.begin(9600);          // Start GPS serial communication
  gsmSerial.begin(9600);   // Start GSM serial communication
  lcd.begin(16, 2);        // Initialize the LCD
  lcd.print("Heart Rate: ");
}

void loop() {
  // Read the pulse rate
  pulseValue = analogRead(pulsePin);

  // Read temperature from DHT sensor
  float temperature = dht.readTemperature();

  // Read GPS coordinates
  while (ss.available() > 0) {
    gps.encode(ss.read());  // Feed GPS data to the GPS object
    if (gps.location.isUpdated()) {  // Check if location is updated
      float latitude = gps.location.lat();
      float longitude = gps.location.lng();

      // Display data on LCD
      lcd.setCursor(0, 1);
      lcd.print("Rate: ");
      lcd.print(pulseValue);  // Display heart rate
      delay(1000);  // Wait 1 second to update data

      // Send emergency SMS alert via GSM module
      gsmSerial.println("AT+CMGF=1");         // Set GSM to text mode
      delay(1000);
      gsmSerial.println("AT+CMGS=\"+1234567890\"");  // Replace with recipient's number
      delay(1000);
      gsmSerial.println("Health Alert: Heart Rate or Location Critical!");  // SMS content
      gsmSerial.println((char)26);  // ASCII code for sending SMS
      delay(5000);  // Wait before sending next alert
    }
  }
}
